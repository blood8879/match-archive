# 팀 가입 및 경기 참석 기능 테스트 가이드

## 개요

이 가이드는 팀 가입 시스템과 경기 참석 기능이 올바르게 작동하는지 테스트하는 방법을 설명합니다.

---

## 1. 테스트 계정 생성

### 사전 요구사항

1. Supabase 프로젝트의 **Service Role Key** 필요
2. `.env` 파일에 다음 추가:
   ```bash
   SUPABASE_SERVICE_ROLE_KEY=your_service_role_key_here
   ```

### 계정 생성 스크립트 실행

```bash
# tsx 설치 (아직 없는 경우)
npm install -D tsx

# 테스트 계정 생성
npx tsx scripts/create-test-users.ts
```

### 생성될 계정 정보

| 번호 | 이메일 | 비밀번호 | 닉네임 | 포지션 | 역할 |
|------|--------|----------|--------|--------|------|
| 1 | test1@example.com | test1234 | 팀장 | MF | 팀 생성 |
| 2 | test2@example.com | test1234 | 선수1 | FW | 가입 테스트 |
| 3 | test3@example.com | test1234 | 선수2 | DF | 가입 테스트 |
| 4 | test4@example.com | test1234 | 선수3 | MF | 가입 테스트 |
| 5 | test5@example.com | test1234 | 선수4 | GK | 가입 테스트 |

---

## 2. 테스트 시나리오

### 시나리오 1: 팀 생성 및 경기 생성 (팀장)

**계정**: test1@example.com

1. **로그인**
   - 이메일: `test1@example.com`
   - 비밀번호: `test1234`

2. **팀 생성**
   - 대시보드 → "팀 생성하기" 클릭
   - 팀 이름: "테스트 FC"
   - 지역: 선택
   - 엠블럼: 업로드 (선택사항)
   - "팀 만들기" 클릭

3. **경기장 등록** (선택사항)
   - 팀 페이지 → "경기장 관리" 클릭
   - "경기장 추가하기" 클릭
   - 경기장 정보 입력 후 저장

4. **경기 생성**
   - 팀 페이지 → "경기 생성" 클릭
   - 경기 일시: 미래 날짜 선택
   - 상대팀: "상대 FC" 입력 (또는 "상대팀 미정" 체크)
   - 경기장: 등록된 경기장 선택 또는 직접 입력
   - "경기 생성하기" 클릭

5. **팀 초대 코드 확인**
   - 팀 페이지 → "팀 설정" 클릭
   - 초대 코드 복사 (다른 계정에서 사용)

**예상 결과**:
- ✅ 팀이 정상적으로 생성됨
- ✅ 경기가 "예정된 경기" 목록에 표시됨
- ✅ 팀 초대 코드가 표시됨

---

### 시나리오 2: 팀 가입 신청 (선수 1-4)

**계정**: test2@example.com, test3@example.com, test4@example.com, test5@example.com

각 계정으로 다음 단계 반복:

1. **로그아웃 후 선수 계정으로 로그인**
   - 브라우저의 다른 창 또는 시크릿 모드 사용 권장

2. **팀 검색 및 가입 신청**
   - 대시보드 → "팀 찾기" 클릭
   - 검색창에 "테스트 FC" 입력
   - 팀 카드 클릭하여 상세 페이지로 이동
   - "가입 신청" 버튼 클릭

**예상 결과**:
- ✅ "가입 신청이 완료되었습니다" 메시지 표시
- ✅ 버튼이 "승인 대기중"으로 변경됨

---

### 시나리오 3: 가입 승인 (팀장)

**계정**: test1@example.com

1. **팀원 관리 페이지로 이동**
   - 대시보드 → "팀 관리" 클릭
   - "팀원 관리" 카드 클릭
   - 또는 팀 페이지 → "가입 대기" 섹션 확인

2. **가입 신청 승인**
   - "승인 대기 중" 섹션에서 대기 중인 멤버 확인
   - 각 멤버의 ✓ (승인) 버튼 클릭
   - 또는 X (거부) 버튼으로 거부 가능

**예상 결과**:
- ✅ 승인된 멤버가 "활성 팀원" 섹션으로 이동
- ✅ 팀원 수가 자동으로 증가
- ✅ 거부된 멤버는 목록에서 제거됨

---

### 시나리오 4: 경기 참석 표시 (선수 1-4)

**계정**: test2-5@example.com

각 계정으로 다음 단계 반복:

1. **경기 상세 페이지로 이동**
   - 대시보드 → "예정된 경기" 섹션에서 경기 클릭
   - 또는 팀 페이지 → 경기 목록에서 클릭

2. **참석 버튼 클릭**
   - "경기 참석" 섹션 확인
   - "참석" 버튼 클릭 (초록색)
   - 또는 "미정" (회색) / "불참" (빨간색) 선택 가능

3. **참석 상태 변경 테스트**
   - 버튼을 다시 클릭하여 상태 변경 가능
   - 예: 참석 → 미정 → 불참 → 참석

**예상 결과**:
- ✅ 버튼 클릭 시 즉시 색상 변경 (낙관적 업데이트)
- ✅ 페이지 새로고침 후에도 상태 유지
- ✅ 다른 상태로 변경 가능

---

### 시나리오 5: 라인업 선택 시 참석자 우선 표시 (팀장)

**계정**: test1@example.com

1. **경기 상세 페이지로 이동**
   - 대시보드 → 경기 클릭

2. **라인업 선택기 확인**
   - "라인업" 섹션에서 팀원 목록 확인
   - 참석 표시한 선수들이 상단에 표시되는지 확인
   - 각 참석자 옆에 "참석" 배지(초록색) 표시 확인

3. **라인업 저장**
   - 참석자들을 체크박스로 선택
   - "라인업 저장" 버튼 클릭

**예상 결과**:
- ✅ 참석 표시한 멤버가 목록 상단에 표시됨
- ✅ 참석자에게 초록색 "참석" 배지 표시
- ✅ 미참석자는 하단에 표시됨
- ✅ 라인업 저장 후 "현재 출전 선수" 카운트 업데이트

---

### 시나리오 6: 경기 완료 및 결과 입력 (팀장)

**계정**: test1@example.com

1. **스코어 입력**
   - 경기 상세 페이지 → "스코어 입력" 섹션
   - +/- 버튼으로 점수 입력
   - 자동 저장됨

2. **득점 기록**
   - "득점 기록" 섹션에서 "득점 추가" 클릭
   - 득점자, 어시스트, 쿼터 선택
   - 저장

3. **경기 완료**
   - 페이지 하단의 "경기 완료" 버튼 클릭
   - 확인 다이얼로그에서 "완료" 클릭

**예상 결과**:
- ✅ 경기 상태가 "완료"로 변경
- ✅ 편집 불가 상태로 전환
- ✅ 승/무/패 결과 표시
- ✅ 팀 통계에 반영

---

## 3. 검증 체크리스트

### 팀 가입 시스템

- [ ] 가입 신청 버튼이 올바르게 동작함
- [ ] 중복 가입 신청 방지됨
- [ ] 팀 매니저가 승인/거부 가능
- [ ] 승인 시 팀원 수 자동 증가
- [ ] 거부 시 신청 기록 삭제
- [ ] RLS 정책으로 권한 제어됨

### 경기 참석 시스템

- [ ] 참석 버튼 3가지 상태(참석/미정/불참) 모두 동작
- [ ] 낙관적 UI 업데이트 작동
- [ ] 참석 상태 변경 가능
- [ ] 페이지 새로고침 후에도 상태 유지
- [ ] 경기 완료 후 참석 버튼 비활성화

### 라인업 시스템

- [ ] 참석자가 목록 상단에 표시됨
- [ ] "참석" 배지가 올바르게 표시됨
- [ ] 라인업 선택/해제 동작
- [ ] 라인업 저장 후 카운트 업데이트
- [ ] 매니저만 편집 가능

---

## 4. 일반적인 문제 해결

### 문제: Service Role Key를 찾을 수 없음

**해결책**:
1. Supabase Dashboard → Settings → API
2. "Service Role Key" 복사 (secret으로 표시됨)
3. `.env` 파일에 추가

### 문제: 테스트 계정이 이미 존재함

**해결책**:
1. Supabase Dashboard → Authentication → Users
2. 기존 테스트 계정 삭제
3. 스크립트 재실행

### 문제: 가입 신청이 보이지 않음

**확인사항**:
- 팀장(OWNER/MANAGER) 계정으로 로그인했는지 확인
- 브라우저 캐시 삭제 후 재시도
- 네트워크 탭에서 API 에러 확인

### 문제: 참석 버튼 클릭 시 오류

**확인사항**:
- 팀 멤버로 승인되었는지 확인
- 브라우저 콘솔에서 에러 메시지 확인
- match_attendance 테이블 RLS 정책 확인

---

## 5. 데이터베이스 확인

### Supabase Dashboard에서 직접 확인

1. **팀 멤버 상태 확인**
   ```sql
   SELECT * FROM team_members WHERE team_id = 'your-team-id';
   ```
   - `status`: 'pending' → 'active'로 변경되었는지 확인

2. **경기 참석 정보 확인**
   ```sql
   SELECT * FROM match_attendance WHERE match_id = 'your-match-id';
   ```
   - 각 멤버의 참석 상태가 저장되었는지 확인

3. **라인업 정보 확인**
   ```sql
   SELECT * FROM match_records WHERE match_id = 'your-match-id';
   ```
   - 선택된 선수들의 레코드가 생성되었는지 확인

---

## 6. 성능 테스트

### 대량 데이터 테스트

1. **추가 테스트 계정 생성** (선택사항)
   - 20-30명의 추가 계정 생성
   - 모두 같은 팀에 가입

2. **참석 상태 다양하게 설정**
   - 일부: 참석
   - 일부: 미정
   - 일부: 불참

3. **라인업 선택기 성능 확인**
   - 정렬이 빠르게 동작하는지
   - UI 렌더링 지연이 없는지

---

## 7. 추가 테스트 시나리오

### 엣지 케이스

1. **동시 참석 상태 변경**
   - 여러 멤버가 동시에 참석 버튼 클릭
   - 데이터 일관성 확인

2. **팀에서 제명된 멤버**
   - 멤버 제명 후 경기 참석 버튼 접근 불가 확인
   - 기존 참석 기록 유지되는지 확인

3. **경기 삭제**
   - 경기 삭제 시 참석 기록도 함께 삭제되는지 확인 (CASCADE)

---

## 마무리

모든 테스트를 통과하면 팀 가입 및 경기 참석 시스템이 정상적으로 작동하는 것입니다.

문제가 발생하면 다음을 확인하세요:
1. Supabase 마이그레이션이 모두 적용되었는지
2. RLS 정책이 올바르게 설정되었는지
3. 환경 변수가 올바르게 설정되었는지
4. 브라우저 콘솔과 네트워크 탭의 에러 메시지
